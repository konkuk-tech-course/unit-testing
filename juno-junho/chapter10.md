# 데이터베이스 테스트
통합테스트라는 퍼즐의 마지막 조각은 프로세스 외부 관리 의존성이다.

가장 일반적인 예는 애플리케이션 데이터베이스이다.

실제 데이터베이스를 테스트하면 회귀방지가 아주 뛰어나지만 설정하기가 쉽지 않다.

이 장에서는 데이터베이스 테스트 시작전에 거쳐야 할 준비 단계인 **데이터베이스 스카미 추적**, **상태 기반 데이터베이스 배포 방식**, **마이그레이션 기반 데이터베이스 배포 방식**의 차이점을 설명하고
**상태기반보다 마이그레이션 기반을 선택해야 하는 이유를** 알아본다.

그리고 테스트 중에 **트랜잭션을 관리하는 방법**과 **남은 데이터를 정리하는 방법**, 그리고 **중요하지 않은 부분을 제거하고 필수 요소를 강조해 테스트를 작게 할 수 있는 방법**을 살펴본다.

여기서는 관계형 DB를 중심적으로 다루지만, 문서형(document-oriented) DB나 일반 텍스트 파일 저장소와 같은
다른 유형의 데이터 저장에도 동일한 원칙을 적용할 수 있다.

## 1. DB 테스트를 위한 전제조건
- 통합테스트에서는 관리 의존성이 그대로 있어야 한다. 목을 사용하는 것은 불가능하기 때문에 비관리 의존성보다 작업하기 더 힘들 수 있다.
- 하지만 테스트를 작성하기 전에 통합 테스트가 가능하게끔 준비 단계를 수행해야 안다.
- 이 절에서는 다음과 같은 전제 조건을 살펴본다.
  - 형상 관리 시스템에 DB유지
  - 모든 개발자를 위한 별도의 DB 인스턴스 사용
  - DB 배포에 마이그레이션 기반 방식 적용
- 테스트에 있어 거의 모든 것과 마찬가지로 테스트를 용ㅇ하게 하면 보통 DB 상태도 개선된다.
- 통합 테스트를 작성하지 않더라도 이러한 실천으로 가치를 얻을 수 있다.

### DB를 형상 관리 시스템에 유지
데이터베이스를 테스트하는 방법의 첫번째 단계는 **데이터베이스 스키마를 일반 코드로 취급하는 것이다.**

일반 코드와 마찬가지로 DB 스키마는 git과 같은 형상 관리 시스템에 저장하는 것이 최선이다.

