# 단위 테스트 안티패턴
- 테스트에서 **시간을 어떻게 다루는지 알아보고**, **비공개 메서드 단위 테스트**, **코드 오염**, **구체 클래스 목 처리** 등과 같은 안티 패턴을 설명하며 이를 피하는 방법도 살펴본다.


## 1. 비공개 메서드 단위테스트
- 단위 테스트를 하려고 비공개 메서드를 노출하는 경우에는 `식별할 수 있는 동작만 테스트`하는 것을 위배한다.
- 비공개 테스트를 노출하면 테스트가 구현 세부 사항과 결합되고 결과적으로 리팩터링 내성이 떨어진다.
> - 리팩터링 내성: 테스트를 실패로 바꾸지 않고 기본 애플리케이션 코드를 리팩터링 할 수 있는지에 대한 척도
- 비공개 메서드를 직접 테스트 하는 대신, 포괄적인 식별할 수 있는 동작으로서 간접적으로 테스트 하는 것이 좋음.

- public 메서드 안에 훨씬더 복잡한 private 메서드가 있고 중요한 비즈니스 로직이라면, **별도의 클래스를 도출해서 명시적으로 작성하는 것**이 좋다.

### 그러면 비공개 메서드 테스트는 타당하지 못한가?

- 비공개 메서드를 테스트하는 것 자체는 나쁘지 않다. 하지만 비공개 메서드가 구현 세부사항의 프록시에 해당하므로 나쁜 것이다.
- 구현 세부 사항을 테스트 하면 궁극적으로 테스트가 깨지기 쉽다. 그래도 메서드가 비공개이면서 식별 할 수 있는 동작인 경우는 드물다.
- 즉, 왠만하면 테스트 하지 마라. 구현 세부사항이 아닌 결과물인 공개 메서드를 통해 테스트 해라..

## 2. 비공개 상태 노출
또 다른 안티패턴으로 단위 테스트 목적으로만 비공개 상태를 노출하는 것이다.

이 지침은 비공개로 지켜야 하는 상태를 노출하지 말고, 식별할 수 있는 동작만 테스트 하라는 비공개 메서드 지침과 같다.

테스트는 제품 코드와 정확히 같은 방식으로 테스트 대상 시스템과 상호 작용해야 하며, 특별한 권한이 따로 있어서는 안 된다.

## 3. 테스트로 유출된 도메인 지식
도메인 지식을 테스트로 유출하는 것은 또 하나의 흔한 안티패턴이다.

제품 코드에서 알고리즘 구현을 복사해 사용하지마라

테스트를 작성할 때 특정 구현을 암시하지 말라.

즉, 단위테스트에서는 처음에는 직관적이지 않아 보일 수 있지만, 예상 결과를 하드코딩하는 것이 좋다. 

## 4. 코드 오염
- 코드 오염의 문제는 테스트 코드와 제품 코드가 혼재돼 유지비가 증가하는 것이다. 이러한 안티 패턴을 방지하려면 테스트코드를 제품 코드 베이스와 분리해야 한다.
- 해결 방법은, 인터페이스를 도입 해 두 가지 구현을 생성하라. 하나는 운영을 위한 진짜 구현체이고, 다른 하나는 테스트 목적으로 한 가짜 구현체이다.

## 5. 구체 클래스를 목으로 처리하기
- 구체 클래스를 대신 목으로 처리해서 본래 클래스의 기능 일부를 보존할 수 있으며, 이는 때때로 유용할 수 있다.
- 기능을 지키려고 구체 클래스를 목으로 처리해야 하면, 이는 단일 책임 원칙을 위반하는 결과이다. 해당 클래스를 두 가지 클래스, 즉 도메인 로직이 있는 클래스와 프로젝트 외부 의존성과 통신하는 클래스로 분리하라.

## 6. 시간 처리하기
- 현재 시간을 앰비언트 컨텍스트로 하면 제품 코드가 오염되고 테스트하기가 더 어려워진다. 서비스나 일반 값의 명시적인 의존성으로 시간을 주입하라.
- 가능하면 항상 일반 값이 좋다.