# 단위 테스트란 무엇인가
- 단위 테스트의 정의는 많은 뉘앙스가 있따. 해석의 차이가 생겼고, 단위 테스트에 접근하는 방법이 두 가지 뚜렷한 견해로 나뉜다.
- `고전파(Classical school)`와 `런던파(London school)`의 두 가지 견해로 나뉜다.
- `고전파`는 모든 사람이 단위 테스트와 테스트 주도 개발에 원론적으로 접근하는 방식이기 때문에 '고전'이라고 한다.
- `런던파`는 런던의 프로그래밍 커뮤니티에서 시작되었다.

## 1. 단위테스트의 정의
단위 테스트에는 많은 정의가 있지만, **가장 중요한 세 가지 속성**은 다음과 같다.
1. **작은 코드 조각(단위)을 검증하고**
2. **빠르게 수행하고**
3. **격리된 방식으로 처리하는 자동화된 테스트이다.**
- `빠르게 수행한다`는 말은 테스트-스위트의 실행 시간이 충분하다면 테스트가 충분히 빠르다는 의미이다.
- `고전파`와 `런던파`를 구분하는 근원적 차이는 바로 세번째의 **격리문제**이다.

### 단위 테스트의 고전파와 런던파
- 고전적 접근법 == 디트로이트(Detroit) == 고전주의적(Classicist) 접근법
> - kent back의 `테스트 주도 개발`이 대표적
- 런던 스타일
> - `목 추종자(Mockist)`라고도 표현.
> - `steve freeman`과 `Nat Pryce`이 가장 유명한 지지자.

### 1.1 격리 문제에 대한 런던파의 접근
- 코드 조각(단위)를 격리된 방식으로 검증한다는 것에 대한 런던파의 입장에 대한 것.
- 런던파에서는 테스트 대상 시스템을 `협력자(collaborator)`에게서 격리하는 것을 일컫는다.
- 즉, 하나의 클래스가 다른 클래스 또는 여러 클래스에 의존하면 이 모든 의존성을 테스트 대역(test double)으로 대체해야 한다.
- 이런 식으로 동작을 외부 영향과 분리해 테스트 대상 클래스에만 집중할 수 있다.
> `테스트 대역`: 복잡성을 줄이고 테스트를 용이하게 하는 단순화된 버전
- 테스트 대상 시스템의 의존성을 테스트 대역으로 대체한다. 이를 통해 테스트 대상 시스템만 검증하는데 집중할 수 있을 뿐 아니라, 규모가 큰 상호 연결 객체 그래프를 분할할 수 있다.
- 이 방법의 이점은 테스트가 실패하면 코드 베이스의 어느 부분이 고장 났는지 확실하게 알 수 있다는 점이다.
- 테스트 실패 -> 확실히 테스트 대상 시스템이 고장난 것이기 때문에. (클래스의 모든 의존성은 테스트 대역으로 대체 되었기 때문에 의심 여지 x)
</br>
- 테스트 대상 시스템의 의존성을 테스트 대역으로 대체함으로서의 이점
  1. 테스트가 실패하면 코드 베이스 어느 부분 고장 났는지 확실히 알 수 있다.
  2. 객체 그래프(Object Graph)를 분할 할 수 있다.
     - 의존성이 얽히고 얽히면 그래프가 상당히 복잡해 질 수 있다. 순환 의존성이 있을 수도 있다.
     - 의존성이 가진 코드 베이스 테스트 하는 것은 테스트 대역없이는 어렵다. 유일하게 남은 선택은 **전체 객체 그래프를 다시 만드는 것**이다.
     - 테스트 대역을 사용하면 객체 그래프를 다시 안만들어도 되고, 클래스의 직접적인 의존성을 대체 할 수 없고, 의존성의 의존성을 다룰 필요도 없다.
  3. 단순한 테스트 스위트의 구조를 확립하는데 도움이 된다.
- 단위 테스트의 격리의 부가적인 이점:
  - `프로젝트 전반적으로 한 번에 한 클래스만 테스트하라`는 지침을 도입하면 전체 단위 테스트를 간단한 구조로 할 수 있다.
  - 더 이상 코드베이스 테스트 하는 방법을 고민 할 필요 x

- 고전 스타일에서는 테스트는 `협력자`를 대체하지 않고 운영용 인스턴스를 사용한다.
- Customer 클래스가 `SUT(System Under Test)`에 Customer, `협력자`에 Store 객체가 존재 할 때, Customer가 올바르게 작동하더라도 Customer에 영향을 미치는 Store 내부에 버그가 있으면 테스트 실패할 수 있음.
- -> 이를 런던 스타일에서는 Store 인스턴스를 `테스트 대역`으로, `Mock`으로 교체한다.
> `Mock`은 테스트 대상 시스템과 협력자 간의 상호 작용을 검사할 수 있는 특별한 테스트 대역이다.
- 런던 스타일은 테스트 대역(Mock)으로 테스트 대상 코드 조각을 분리해 격리 요구사항에 다가가는 것이다.
- 하지만 이 관점은 무엇이 작은 코드 조각(단위)에 해당하는지에 대한 견해에도 영향을 미친다.

### 격리 문제에 대한 고전파의 접근
- `작은 코드 조각은 얼마나 작아야 하는가?`에 대해서 각각의 모든 클래스를 격리해야 한다면 테스트 대상 코드 조각은 당연히 `단일 클래스`나 `해당 클래스의 메서드`여야 한다.
- 일반적으로 한 번에 한 클래스로 테스트하는 지침을 따르려고 노력해야 한다.
</br></br>
- 고전적인 방법에서는 코드를 꼭 격리하는 방식으로 테스트해야 하는 것은 아니다.
- 대신 단위 테스트는 서로 격리해서 실행해야 한다.
- 따라서 테스트를 순서에 상관없이 가장 적합한 방식으로 실행할 수 있으며 서로의 결과에 영향을 미치지 않는다.
- 각각의 테스트를 격리하는 것은 여러 클래스가 모두 메모리에 상주하고 공유 상태가 도달하지 않는 한, **여러 클래스를 한 번에 테스트 해도 괜찮다는 것**이다.
- 이를 통해 테스트가 서로 소통하고 실행 컨텍스트에 영향을 줄 수 있다.

#### 공유 의존성, 비공개 의존성, 프로세스 외부 의존성
- `공유 의존성(shared dependency)`란 테스트 간에 공유되고 서로의 결과에 영향을 미칠 수 있는 수단을 제공하는 의존성이다.
  - e.g) static mutable field, 데이터베이스
- `비공개 의존성(private dependnecy)`: 공유하지 않는 의존성
- `프로세스 외부 의존성(out-of-process dependency)`: 애플리케이션 실행 프로세스 외부에서 실행되는 의존성
- 
